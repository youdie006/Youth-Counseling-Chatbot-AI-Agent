# docker-compose.yml - ë¡œì»¬ ê°œë°œ ìµœì í™”

services:
  simsimi-ai-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: simsimi_ai_agent
    ports:
      - "7860:7860"  # í—ˆê¹…í˜ì´ìŠ¤ì™€ ë™ì¼í•œ í¬íŠ¸
    volumes:
      # ğŸ”„ ì†ŒìŠ¤ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ (ê°œë°œìš©)
      - ./src:/app/src
      - ./scripts:/app/scripts
      - ./main.py:/app/main.py
      - ./static:/app/static
      
      # ğŸ’¾ ë°ì´í„° ì˜êµ¬ ì €ì¥
      - ./data:/app/data
      - ./logs:/app/logs
      - ./cache:/app/cache
      
      # ğŸ”‘ í™˜ê²½ë³€ìˆ˜ (ë¡œì»¬ì—ì„œë§Œ)
      - ./.env:/app/.env:ro
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
      - HF_HOME=/app/cache
      - LOCAL_DEV=true           # ğŸ  ë¡œì»¬ ê°œë°œ í™˜ê²½ í‘œì‹œ
      - DEVELOPMENT_MODE=true    # ğŸ”§ ê°œë°œ ëª¨ë“œ í™œì„±í™”
    env_file:
      - .env
    restart: unless-stopped
    stdin_open: true
    tty: true
    networks:
      - simsimi_network

  # ğŸš€ í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ìš© (ì˜µì…˜)
  simsimi-production-test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: simsimi_production_test
    ports:
      - "7861:7860"  # ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë™ì‹œ ì‹¤í–‰
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./cache:/app/cache
      - ./.env:/app/.env:ro
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
      - HF_HOME=/app/cache
      - PRODUCTION=true          # ğŸ­ í”„ë¡œë•ì…˜ ëª¨ë“œ í…ŒìŠ¤íŠ¸
    env_file:
      - .env
    restart: unless-stopped
    profiles:
      - production-test  # docker-compose --profile production-test up
    networks:
      - simsimi_network

networks:
  simsimi_network:
    driver: bridge

# ì‚¬ìš©ë²•:
# ê°œë°œ: docker-compose up
# í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸: docker-compose --profile production-test up